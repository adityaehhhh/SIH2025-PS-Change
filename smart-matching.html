<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farmer-Buyer Matching</title>
    <style>
        /* Base Styles - for all screens */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .selection-screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }

        select, input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .start-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .battle-screen {
            display: none;
            position: relative;
        }

        .battle-arena {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .vs-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 40px;
            margin-bottom: 30px;
        }

        .fighter {
            flex: 1;
            text-align: center;
        }

        .photo-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            position: relative;
        }
        
        /* --- TEKKEN SCROLL ANIMATION CSS --- */
        /* Keyframe for continuous vertical scroll */
        @keyframes continuous-scroll {
            0% { transform: translateY(0); }
            /* This value ensures a continuous loop of the repeated content */
            100% { transform: translateY(-100%); } 
        }

        .farmer-photos {
            position: relative;
            height: 200px; /* Must match .photo-container height */
            overflow: hidden; 
        }
        
        /* The inner container that holds the replicated images */
        .scrolling-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            /* This is initially set by JS based on the number of images */
            /* height: 2200px; */ 
        }

        .scrolling-wrapper.is-scrolling {
            /* Smooth, fast scroll */
            animation: continuous-scroll 0.5s linear infinite;
        }
        
        .scrolling-item {
            width: 100%;
            height: 200px; /* Each item must match container height */
            flex-shrink: 0;
        }

        .scrolling-item.matched {
             /* Set height back to 200px to display only the single matched image */
            height: 200px !important;
        }
        
        .scrolling-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .final-image {
             /* Hides the final, correctly matched image during the scroll */
            display: none;
        }

        .final-image.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        /* --- END OF TEKKEN SCROLL ANIMATION CSS --- */


        .vs-text {
            font-size: 4em;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fighter-name {
            font-size: 1.5em;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .fighter-label {
            color: #ffd700;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .match-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            color: white;
            margin-top: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #ffd700;
        }

        .celebration {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8em;
            animation: celebrate 1s ease-out;
            z-index: 10;
        }

        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.5) rotate(180deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); }
        }

        .match-found {
            display: none;
            text-align: center;
            color: #4caf50;
            font-size: 2.5em;
            font-weight: bold;
            margin: 20px 0;
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .action-buttons {
            display: none;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
        }

        .action-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            flex-grow: 1;
        }

        .chat-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            animation: slideIn 0.5s ease-out;
        }

        .previous-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            animation: slideIn 0.5s ease-out 0.2s backwards;
        }

        @keyframes slideIn {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .hidden {
            display: none !important;
        }

        /* --- Responsive Styles (Mobile First) --- */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            .selection-screen {
                padding: 20px;
            }

            .battle-arena {
                padding: 20px 10px;
            }

            .vs-container {
                flex-direction: column;
                gap: 10px;
            }

            .fighter {
                margin-bottom: 20px;
            }

            .photo-container {
                width: 150px;
                height: 150px;
            }
            
            /* Ensure scrolling wrapper size is correct on mobile */
            .farmer-photos {
                height: 150px;
            }
            .scrolling-item {
                height: 150px; 
            }

            .vs-text {
                font-size: 3em;
                margin: 20px 0;
            }
            
            .fighter-label {
                font-size: 1em;
            }
            
            .fighter-name {
                font-size: 1.2em;
            }

            .match-found {
                font-size: 2em;
            }

            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="selection-screen" id="selectionScreen">
            <h1>ðŸŒ¾ Smart Farmer-Buyer Matching ðŸŒ¾</h1>
            
            <div class="form-group">
                <label for="oilseed">Select Oilseed Type:</label>
                <select id="oilseed">
                    <option value="">-- Choose Oilseed --</option>
                    </select>
            </div>

            <div class="form-group">
                <label for="byproduct">Select By-Product:</label>
                <select id="byproduct" disabled>
                    <option value="">-- First Select Oilseed --</option>
                    </select>
            </div>

            <div class="form-group">
                <label for="quantity">Quantity (kg):</label>
                <input type="number" id="quantity" placeholder="Enter quantity in kg" min="1">
            </div>

            <div class="form-group">
                <label for="price">Price (â‚¹/kg):</label>
                <input type="number" id="price" placeholder="Enter your price in â‚¹/kg" min="1">
            </div>

            <button class="start-btn" id="startMatchingBtn" disabled>Start Matching</button>
        </div>

        <div class="battle-screen" id="battleScreen">
            <div class="battle-arena">
                <div class="celebration" id="celebration">ðŸŽ‰</div>
                <div class="match-found" id="matchFound">MATCH FOUND!!!</div>

                <div class="vs-container">
                    <div class="fighter">
                        <div class="fighter-label">BUYER (You)</div>
                        <div class="photo-container">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=buyer" alt="Buyer" id="buyerPhoto">
                        </div>
                        <div class="fighter-name" id="buyerName">Your Demand</div>
                    </div>

                    <div class="vs-text" id="vsText">VS</div>

                    <div class="fighter">
                        <div class="fighter-label">FARMER</div>
                        <div class="photo-container">
                            <div class="farmer-photos" id="farmerPhotos">
                                <div class="scrolling-wrapper" id="scrollingWrapper">
                                    </div>
                                <img class="final-image" id="finalFarmerPhoto" src="" alt="Matched Farmer">
                            </div>
                        </div>
                        <div class="fighter-name" id="farmerName">Searching...</div>
                    </div>
                </div>

                <div class="match-info" id="matchInfo">
                    <div class="info-row">
                        <span class="info-label">Product:</span>
                        <span id="cropInfo">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Your Demand:</span>
                        <span id="demandInfo">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Your Offer Price:</span>
                        <span id="priceInfo">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Offered Supply:</span>
                        <span id="supplyInfo">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Offered Price:</span>
                        <span id="offeredPriceInfo">-</span>
                    </div>
                </div>

                <div class="action-buttons" id="actionButtons">
                    <button class="action-btn chat-btn" id="chatBtn">Start Chatting</button>
                    <button class="action-btn previous-btn" id="goBackBtn">New Search</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Full Oilseed Data ---
        const oilseedData = {
            "Soybean": { byproducts: { "Soybean Meal (44% Protein)": { basePrice: 3200, volatility: 150, demand: ["Poultry Farms", "Cattle Feed Mills", "Aquaculture", "Pet Food Industry", "Organic Fertilizer Companies"] }, "Soybean Meal (48% Protein)": { basePrice: 3500, volatility: 180, demand: ["Premium Poultry Feed", "Export Markets", "Animal Nutrition Companies", "Livestock Farms"] }, "Soybean Cake": { basePrice: 2800, volatility: 120, demand: ["Small Dairy Farms", "Local Feed Suppliers", "Organic Farms"] }, "Soy Hulls": { basePrice: 800, volatility: 60, demand: ["Biomass Energy Plants", "Mushroom Cultivation", "Compost Producers", "Particle Board Manufacturers"] }, "Soy Lecithin": { basePrice: 12000, volatility: 500, demand: ["Food Processing Companies", "Pharmaceutical Industry", "Cosmetics Manufacturers", "Chocolate Industry"] }, "Soy Protein Concentrate": { basePrice: 8500, volatility: 400, demand: ["Health Food Companies", "Protein Supplement Brands", "Meat Alternatives", "Bakery Industry"] }, "Soy Protein Isolate": { basePrice: 15000, volatility: 700, demand: ["Sports Nutrition Brands", "Infant Formula", "Medical Nutrition", "Vegan Products"] }, "Textured Vegetable Protein": { basePrice: 6000, volatility: 300, demand: ["Meat Substitute Companies", "Vegan Food Brands", "School Lunch Programs"] }, "Soapstock": { basePrice: 1500, volatility: 100, demand: ["Soap Manufacturers", "Biodiesel Producers", "Industrial Chemicals"] } } },
            "Groundnut": { byproducts: { "Groundnut Meal": { basePrice: 2400, volatility: 120, demand: ["Poultry Feed", "Cattle Feed", "Fish Feed", "Pet Food"] }, "Groundnut Cake": { basePrice: 2200, volatility: 110, demand: ["Dairy Farms", "Goat Farms", "Organic Fertilizer"] }, "Peanut Shells": { basePrice: 400, volatility: 40, demand: ["Biofuel Plants", "Mushroom Growers", "Particle Board", "Cat Litter Manufacturers"] }, "Peanut Hulls": { basePrice: 300, volatility: 30, demand: ["Biomass Pellets", "Animal Bedding", "Mulch Producers"] }, "Peanut Skins": { basePrice: 600, volatility: 50, demand: ["Antioxidant Extraction", "Cosmetics Industry", "Natural Dyes"] } } },
            "Sunflower": { byproducts: { "Sunflower Meal (28% Protein)": { basePrice: 1800, volatility: 90, demand: ["Cattle Feed", "Sheep Feed", "Goat Feed"] }, "Sunflower Meal (36% Protein)": { basePrice: 2100, volatility: 110, demand: ["Poultry Feed", "Pig Feed", "Horse Feed"] }, "Sunflower Cake": { basePrice: 1600, volatility: 80, demand: ["Small Farms", "Dairy Cooperatives", "Organic Farms"] }, "Sunflower Hulls": { basePrice: 350, volatility: 35, demand: ["Biofuel Briquettes", "Compost Industry", "Mulch", "Animal Bedding"] }, "Sunflower Husk": { basePrice: 300, volatility: 30, demand: ["Biomass Energy", "Pellet Production", "Board Manufacturing"] } } },
            "Rapeseed": { byproducts: { "Rapeseed Meal": { basePrice: 2000, volatility: 100, demand: ["Cattle Feed", "Pig Feed", "Aquaculture"] }, "Canola Meal": { basePrice: 2200, volatility: 120, demand: ["Poultry Feed", "Export Markets", "Livestock"] }, "Rapeseed Cake": { basePrice: 1800, volatility: 90, demand: ["Dairy Farms", "Beef Cattle", "Fertilizer"] }, "Rapeseed Hulls": { basePrice: 400, volatility: 40, demand: ["Biofuel", "Compost", "Animal Bedding"] } } },
            "Mustard": { byproducts: { "Mustard Cake": { basePrice: 1600, volatility: 80, demand: ["Organic Fertilizer", "Fish Pond Treatment", "Biopesticide", "Nematode Control"] }, "Mustard Meal": { basePrice: 1400, volatility: 70, demand: ["Cattle Feed", "Goat Feed", "Soil Amendment"] }, "De-oiled Mustard Cake": { basePrice: 1200, volatility: 60, demand: ["Organic Farms", "Kitchen Garden", "Nurseries"] }, "Mustard Husk": { basePrice: 250, volatility: 25, demand: ["Biomass", "Compost", "Mulch"] } } },
            "Cottonseed": { byproducts: { "Cottonseed Meal": { basePrice: 2600, volatility: 130, demand: ["Cattle Feed", "Dairy Farms", "Goat Farms"] }, "Cottonseed Cake": { basePrice: 2400, volatility: 120, demand: ["Livestock Feed", "Organic Fertilizer"] }, "Cottonseed Hulls": { basePrice: 600, volatility: 50, demand: ["Cattle Feed", "Mushroom Substrate", "Mulch"] }, "Cotton Linters": { basePrice: 8000, volatility: 400, demand: ["Paper Industry", "Explosives", "Cushion Filling", "Currency Paper"] } } },
            "Palm Kernel": { byproducts: { "Palm Kernel Meal": { basePrice: 1500, volatility: 80, demand: ["Cattle Feed", "Poultry Feed", "Aquaculture"] }, "Palm Kernel Expeller": { basePrice: 1600, volatility: 85, demand: ["Animal Feed", "Export Markets"] }, "Palm Kernel Shell": { basePrice: 800, volatility: 60, demand: ["Activated Carbon", "Biofuel", "Charcoal Briquettes"] } } },
            "Copra": { byproducts: { "Copra Meal": { basePrice: 1800, volatility: 90, demand: ["Cattle Feed", "Poultry Feed", "Pet Food"] }, "Coconut Meal": { basePrice: 1700, volatility: 85, demand: ["Livestock", "Aquaculture", "Organic Feed"] }, "Coconut Shell": { basePrice: 1200, volatility: 80, demand: ["Activated Carbon", "Handicrafts", "Charcoal"] }, "Coconut Husk": { basePrice: 400, volatility: 40, demand: ["Coir Industry", "Growing Medium", "Erosion Control"] } } },
            "Sesame": { byproducts: { "Sesame Meal": { basePrice: 3000, volatility: 150, demand: ["Premium Animal Feed", "Poultry", "Health Supplements"] }, "Sesame Cake": { basePrice: 2800, volatility: 140, demand: ["Livestock", "Organic Farms", "Fertilizer"] }, "Sesame Hulls": { basePrice: 500, volatility: 50, demand: ["Biomass", "Compost", "Mulch"] } } },
            "Linseed": { byproducts: { "Linseed Meal": { basePrice: 2500, volatility: 125, demand: ["Cattle Feed", "Omega-3 Supplements", "Health Food"] }, "Linseed Cake": { basePrice: 2300, volatility: 115, demand: ["Dairy Farms", "Livestock", "Organic Feed"] }, "Flax Hulls": { basePrice: 400, volatility: 40, demand: ["Dietary Fiber", "Biomass", "Compost"] } } },
            "Safflower": { byproducts: { "Safflower Meal": { basePrice: 1600, volatility: 80, demand: ["Poultry Feed", "Cattle Feed"] }, "Safflower Cake": { basePrice: 1400, volatility: 70, demand: ["Animal Feed", "Bird Seed Mix"] }, "Safflower Hulls": { basePrice: 300, volatility: 30, demand: ["Biomass", "Mulch"] } } },
            "Castor": { byproducts: { "Castor Meal (Detoxified)": { basePrice: 1200, volatility: 80, demand: ["Organic Fertilizer", "Biopesticide", "Nematicide"] }, "Castor Cake": { basePrice: 1000, volatility: 70, demand: ["Organic Farms", "Soil Amendment"] }, "Castor Hulls": { basePrice: 200, volatility: 20, demand: ["Biomass", "Compost"] } } },
            "Niger Seed": { byproducts: { "Niger Seed Meal": { basePrice: 1800, volatility: 90, demand: ["Bird Feed", "Cattle Feed", "Poultry"] }, "Niger Cake": { basePrice: 1600, volatility: 80, demand: ["Animal Feed", "Livestock"] }, "Niger Seed Hulls": { basePrice: 300, volatility: 30, demand: ["Biomass", "Mulch"] } } },
            "Black Seed": { byproducts: { "Black Seed Meal": { basePrice: 8000, volatility: 400, demand: ["Health Supplements", "Herbal Medicine", "Cosmetics"] }, "Nigella Cake": { basePrice: 7000, volatility: 350, demand: ["Nutraceuticals", "Traditional Medicine"] } } },
            "Babassu": { byproducts: { "Babassu Meal": { basePrice: 1400, volatility: 70, demand: ["Animal Feed", "Biofuel"] }, "Babassu Cake": { basePrice: 1200, volatility: 60, demand: ["Livestock", "Biomass"] }, "Babassu Shell": { basePrice: 800, volatility: 60, demand: ["Charcoal", "Activated Carbon"] } } },
            "Shea Nut": { byproducts: { "Shea Nut Meal": { basePrice: 2000, volatility: 100, demand: ["Animal Feed", "Fertilizer"] }, "Shea Nut Cake": { basePrice: 1800, volatility: 90, demand: ["Livestock", "Organic Farms"] } } },
            "Perilla": { byproducts: { "Perilla Meal": { basePrice: 3500, volatility: 175, demand: ["Health Food", "Omega-3 Supplements"] }, "Perilla Cake": { basePrice: 3200, volatility: 160, demand: ["Premium Feed", "Nutraceuticals"] } } },
            "Hemp": { byproducts: { "Hemp Seed Meal": { basePrice: 4000, volatility: 200, demand: ["Health Food", "Protein Supplements", "Animal Feed"] }, "Hemp Seed Cake": { basePrice: 3800, volatility: 190, demand: ["Organic Feed", "Vegan Products"] }, "Hemp Hulls": { basePrice: 1000, volatility: 80, demand: ["Animal Bedding", "Mulch"] } } },
            "Poppy": { byproducts: { "Poppy Seed Meal": { basePrice: 3000, volatility: 150, demand: ["Bakery Industry", "Health Food"] }, "Poppy Seed Cake": { basePrice: 2800, volatility: 140, demand: ["Food Processing", "Animal Feed"] } } },
            "Chia": { byproducts: { "Chia Seed Meal": { basePrice: 6000, volatility: 300, demand: ["Health Food", "Smoothie Industry", "Bakery"] }, "De-oiled Chia Cake": { basePrice: 5500, volatility: 275, demand: ["Protein Supplements", "Vegan Products"] } } },
            "Amaranth": { byproducts: { "Amaranth Meal": { basePrice: 4500, volatility: 225, demand: ["Gluten-Free Products", "Health Food", "Bakery"] }, "Amaranth Cake": { basePrice: 4200, volatility: 210, demand: ["Nutrition Bars", "Cereals"] } } },
            "Camelina": { byproducts: { "Camelina Meal": { basePrice: 2200, volatility: 110, demand: ["Animal Feed", "Aquaculture", "Biofuel"] }, "Camelina Cake": { basePrice: 2000, volatility: 100, demand: ["Livestock", "Omega-3 Supplements"] } } },
            "Jatropha": { byproducts: { "Jatropha Meal (Detoxified)": { basePrice: 800, volatility: 60, demand: ["Organic Fertilizer", "Biopesticide"] }, "Jatropha Cake": { basePrice: 600, volatility: 50, demand: ["Biofuel", "Soil Amendment"] } } },
            "Tung": { byproducts: { "Tung Meal": { basePrice: 1000, volatility: 70, demand: ["Industrial Applications", "Wood Finish"] }, "Tung Cake": { basePrice: 800, volatility: 60, demand: ["Biofuel", "Industrial Chemicals"] } } },
            "Crambe": { byproducts: { "Crambe Meal": { basePrice: 1500, volatility: 75, demand: ["Animal Feed", "Industrial Oil"] }, "Crambe Cake": { basePrice: 1300, volatility: 65, demand: ["Livestock", "Biofuel"] } } },
            "Borage": { byproducts: { "Borage Meal": { basePrice: 5000, volatility: 250, demand: ["Health Supplements", "Cosmetics", "Anti-inflammatory"] }, "Borage Cake": { basePrice: 4800, volatility: 240, demand: ["Nutraceuticals", "Skin Care"] } } },
            "Evening Primrose": { byproducts: { "Evening Primrose Meal": { basePrice: 7000, volatility: 350, demand: ["Health Supplements", "Cosmetics", "Pharmaceuticals"] }, "Evening Primrose Cake": { basePrice: 6500, volatility: 325, demand: ["Women's Health Products", "Skin Care"] } } },
            "Calendula": { byproducts: { "Calendula Meal": { basePrice: 6000, volatility: 300, demand: ["Cosmetics", "Herbal Medicine", "Skin Care"] }, "Calendula Cake": { basePrice: 5500, volatility: 275, demand: ["Natural Products", "Healing Creams"] } } },
            "Neem": { byproducts: { "Neem Cake": { basePrice: 1400, volatility: 70, demand: ["Organic Fertilizer", "Biopesticide", "Nematicide", "Soil Conditioner"] }, "Neem Meal": { basePrice: 1200, volatility: 60, demand: ["Organic Farms", "Kitchen Gardens", "Plant Nurseries"] }, "De-oiled Neem Cake": { basePrice: 1000, volatility: 50, demand: ["Fertilizer", "Pest Control"] } } },
            "Karanja": { byproducts: { "Karanja Cake": { basePrice: 1600, volatility: 80, demand: ["Biopesticide", "Organic Fertilizer", "Fish Farms"] }, "Pongamia Meal": { basePrice: 1400, volatility: 70, demand: ["Soil Amendment", "Pest Control"] } } },
            "Mahua": { byproducts: { "Mahua Cake": { basePrice: 1000, volatility: 60, demand: ["Organic Fertilizer", "Fish Farming", "Ethanol Production"] }, "Mahua De-oiled Cake": { basePrice: 800, volatility: 50, demand: ["Fertilizer", "Aquaculture"] } } },
            "Kokum": { byproducts: { "Kokum Seed Meal": { basePrice: 3000, volatility: 150, demand: ["Cosmetics", "Pharmaceuticals"] }, "Kokum Seed Cake": { basePrice: 2800, volatility: 140, demand: ["Skin Care", "Health Products"] } } },
            "Sal": { byproducts: { "Sal Seed Cake": { basePrice: 1200, volatility: 60, demand: ["Animal Feed", "Biofuel"] }, "Sal Seed Meal": { basePrice: 1000, volatility: 50, demand: ["Livestock", "Biomass"] } } },
            "Olive": { byproducts: { "Olive Pomace Meal": { basePrice: 2500, volatility: 125, demand: ["Animal Feed", "Cosmetics"] }, "Olive Pit": { basePrice: 800, volatility: 60, demand: ["Biomass Fuel", "Activated Carbon"] } } },
            "Tallow Tree": { byproducts: { "Tallow Seed Meal": { basePrice: 1500, volatility: 75, demand: ["Biodiesel", "Soap Making"] }, "Tallow Seed Cake": { basePrice: 1300, volatility: 65, demand: ["Industrial Applications"] } } },
            "Brazil Nut": { byproducts: { "Brazil Nut Meal": { basePrice: 8000, volatility: 400, demand: ["Premium Food Products", "Cosmetics"] }, "Brazil Nut Cake": { basePrice: 7500, volatility: 375, demand: ["Health Food", "Skin Care"] } } },
            "Macadamia": { byproducts: { "Macadamia Nut Meal": { basePrice: 12000, volatility: 600, demand: ["Premium Cosmetics", "Health Food"] }, "Macadamia Cake": { basePrice: 11000, volatility: 550, demand: ["Luxury Products", "Skin Care"] } } },
            "Walnut": { byproducts: { "Walnut Meal": { basePrice: 6000, volatility: 300, demand: ["Health Food", "Bakery", "Cosmetics"] }, "Walnut Cake": { basePrice: 5500, volatility: 275, demand: ["Food Industry", "Protein Supplements"] }, "Walnut Shell": { basePrice: 1500, volatility: 100, demand: ["Abrasives", "Activated Carbon", "Cosmetics Scrubs"] } } },
            "Almond": { byproducts: { "Almond Meal": { basePrice: 15000, volatility: 750, demand: ["Premium Bakery", "Gluten-Free Products", "Cosmetics"] }, "Almond Cake": { basePrice: 14000, volatility: 700, demand: ["Health Food", "Protein Bars", "Skin Care"] }, "Almond Shell": { basePrice: 800, volatility: 60, demand: ["Biomass", "Garden Mulch", "Animal Bedding"] } } },
            "Hazelnut": { byproducts: { "Hazelnut Meal": { basePrice: 10000, volatility: 500, demand: ["Chocolate Industry", "Bakery", "Confectionery"] }, "Hazelnut Cake": { basePrice: 9000, volatility: 450, demand: ["Premium Food Products", "Health Supplements"] }, "Hazelnut Shell": { basePrice: 600, volatility: 50, demand: ["Biomass", "Activated Carbon", "Garden Products"] } } },
            "Pistachio": { byproducts: { "Pistachio Meal": { basePrice: 18000, volatility: 900, demand: ["Premium Bakery", "Ice Cream Industry", "Confectionery"] }, "Pistachio Cake": { basePrice: 16000, volatility: 800, demand: ["Luxury Food Products", "Health Food"] }, "Pistachio Shell": { basePrice: 1000, volatility: 80, demand: ["Natural Dyes", "Handicrafts", "Garden Mulch"] } } },
            "Pecan": { byproducts: { "Pecan Meal": { basePrice: 12000, volatility: 600, demand: ["Premium Bakery", "Health Food", "Protein Products"] }, "Pecan Cake": { basePrice: 11000, volatility: 550, demand: ["Confectionery", "Ice Cream", "Snacks"] }, "Pecan Shell": { basePrice: 800, volatility: 60, demand: ["Mulch", "Biomass", "Garden Products"] } } },
            "Argan": { byproducts: { "Argan Seed Meal": { basePrice: 20000, volatility: 1000, demand: ["Luxury Cosmetics", "Premium Skin Care", "Hair Care"] }, "Argan Cake": { basePrice: 18000, volatility: 900, demand: ["Anti-Aging Products", "Health Supplements"] }, "Argan Shell": { basePrice: 2000, volatility: 150, demand: ["Biomass", "Activated Carbon", "Exfoliants"] } } },
            "Tamanu": { byproducts: { "Tamanu Seed Meal": { basePrice: 15000, volatility: 750, demand: ["Pharmaceutical", "Wound Healing", "Skin Care"] }, "Tamanu Cake": { basePrice: 14000, volatility: 700, demand: ["Medical Cosmetics", "Natural Medicine"] } } },
            "Moringa": { byproducts: { "Moringa Seed Cake": { basePrice: 5000, volatility: 250, demand: ["Water Purification", "Organic Fertilizer", "Animal Feed"] }, "Moringa Seed Meal": { basePrice: 4500, volatility: 225, demand: ["Health Supplements", "Nutritional Products"] } } },
            "Inca Inchi": { byproducts: { "Inca Inchi Meal": { basePrice: 8000, volatility: 400, demand: ["Omega-3 Supplements", "Health Food", "Vegan Protein"] }, "Sacha Inchi Cake": { basePrice: 7500, volatility: 375, demand: ["Premium Nutrition", "Sports Supplements"] } } },
            "Marula": { byproducts: { "Marula Seed Meal": { basePrice: 10000, volatility: 500, demand: ["Premium Cosmetics", "Anti-Aging Products", "Hair Care"] }, "Marula Cake": { basePrice: 9000, volatility: 450, demand: ["Luxury Skin Care", "Natural Beauty Products"] } } },
            "Baobab": { byproducts: { "Baobab Seed Meal": { basePrice: 6000, volatility: 300, demand: ["Health Supplements", "Nutritional Products", "Cosmetics"] }, "Baobab Cake": { basePrice: 5500, volatility: 275, demand: ["Vitamin C Supplements", "Skin Care"] } } }
        };
        // --- End of Oilseed Data ---

        // DOM Elements
        const oilseedSelect = document.getElementById('oilseed');
        const byproductSelect = document.getElementById('byproduct');
        const quantityInput = document.getElementById('quantity');
        const priceInput = document.getElementById('price');
        const startMatchingBtn = document.getElementById('startMatchingBtn');
        const selectionScreen = document.getElementById('selectionScreen');
        const battleScreen = document.getElementById('battleScreen');
        const scrollingWrapper = document.getElementById('scrollingWrapper');
        const finalFarmerPhoto = document.getElementById('finalFarmerPhoto');
        const farmerName = document.getElementById('farmerName');
        const vsText = document.getElementById('vsText');
        const matchFound = document.getElementById('matchFound');
        const celebration = document.getElementById('celebration');
        const actionButtons = document.getElementById('actionButtons');

        const farmerNames = ['Rajesh Kumar', 'Suresh Patel', 'Amit Singh', 'Vijay Sharma', 'Ramesh Yadav', 'Priya Singh', 'Sneha Reddy', 'Karan Mehta', 'Balwant Singh', 'Javed Khan', 'Deepa Patil', 'Kisan Bhai', 'Anjali Devi', 'Sunil Taneja', 'Firoz Ahmed', 'Gauri Mishra'];

        // Initial setup to populate oilseed dropdown
        function setupOilseedOptions() {
            Object.keys(oilseedData).sort().forEach(oilseed => {
                const option = document.createElement('option');
                option.value = oilseed;
                option.textContent = oilseed;
                oilseedSelect.appendChild(option);
            });
        }
        
        // Handle oilseed selection: populate byproducts
        oilseedSelect.addEventListener('change', function() {
            byproductSelect.disabled = !this.value;
            byproductSelect.innerHTML = '<option value="">-- Choose By-Product --</option>';
            
            if (this.value) {
                const byproducts = oilseedData[this.value].byproducts;
                Object.keys(byproducts).sort().forEach(byproduct => {
                    const option = document.createElement('option');
                    option.value = byproduct;
                    option.textContent = byproduct;
                    byproductSelect.appendChild(option);
                });
            }
            checkFormComplete();
        });

        // Check if all fields are filled to enable the button
        function checkFormComplete() {
            const isComplete = oilseedSelect.value && byproductSelect.value && 
                               quantityInput.value > 0 && priceInput.value > 0;
            startMatchingBtn.disabled = !isComplete;
        }

        // Listeners for form validation
        byproductSelect.addEventListener('change', checkFormComplete);
        quantityInput.addEventListener('input', checkFormComplete);
        priceInput.addEventListener('input', checkFormComplete);
        
        // --- Core Animation Logic: Generation and Control ---
        function generateScrollingImages(names) {
            // We need enough images to scroll through 100% of the wrapper twice to make the loop smooth.
            const numImages = names.length;
            const doubledNames = names.concat(names).concat(names); // Triple the list for a long scroll
            
            scrollingWrapper.innerHTML = ''; // Clear previous images
            
            doubledNames.forEach((name, index) => {
                const div = document.createElement('div');
                div.classList.add('scrolling-item');
                const img = document.createElement('img');
                // Use index as seed for variety
                img.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=scroller${index}`; 
                img.alt = name;
                div.appendChild(img);
                scrollingWrapper.appendChild(div);
            });
            
            // Set the total height for the wrapper to allow for the -100% translation
            const itemHeight = 200; // Match CSS .photo-container height (desktop value)
            const finalHeight = doubledNames.length * itemHeight;
            scrollingWrapper.style.height = `${finalHeight}px`;
        }
        
        function resetBattleScreen() {
            farmerName.textContent = 'Searching...';
            vsText.textContent = 'VS';
            vsText.style.color = '#ff6b6b';
            matchFound.style.display = 'none';
            celebration.style.display = 'none';
            actionButtons.style.display = 'none';
            scrollingWrapper.classList.remove('is-scrolling');
            finalFarmerPhoto.classList.remove('show');
            document.getElementById('cropInfo').textContent = '-';
            document.getElementById('demandInfo').textContent = '-';
            document.getElementById('priceInfo').textContent = '-';
            document.getElementById('supplyInfo').textContent = '-';
            document.getElementById('offeredPriceInfo').textContent = '-';
        }

        startMatchingBtn.addEventListener('click', function() {
            resetBattleScreen(); 
            selectionScreen.classList.add('hidden');
            battleScreen.style.display = 'block';
            startBattleAnimation();
        });

        function startBattleAnimation() {
            // 1. Setup the scrollable images and start the animation
            generateScrollingImages(farmerNames);
            scrollingWrapper.classList.add('is-scrolling');
            
            // 2. Stop after 3 seconds and show match
            setTimeout(() => {
                scrollingWrapper.classList.remove('is-scrolling'); // Stop CSS scroll animation
                scrollingWrapper.style.display = 'none'; // Hide the scrolling list
                
                // Final Matched Farmer Data
                const randomFarmerName = farmerNames[Math.floor(Math.random() * farmerNames.length)];
                
                const oilseed = oilseedSelect.value;
                const byproduct = byproductSelect.value;
                const byproductData = oilseedData[oilseed].byproducts[byproduct];
                
                // Calculation logic
                const varianceRange = byproductData.volatility / 10;
                const priceOffset = (Math.random() * varianceRange * 2) - varianceRange; 
                const offeredPrice = Math.round(byproductData.basePrice + priceOffset);
                
                const quantity = parseFloat(quantityInput.value);
                const supplyMultiplier = 0.8 + Math.random() * 0.4;
                const supply = Math.round(quantity * supplyMultiplier);

                farmerName.textContent = randomFarmerName;
                finalFarmerPhoto.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${randomFarmerName.replace(/\s/g, '')}`; // Set final photo
                finalFarmerPhoto.classList.add('show'); // Show the final image

                // 3. Match Reveal Sequence
                
                // Show celebration
                celebration.style.display = 'block';
                setTimeout(() => celebration.style.display = 'none', 1000);
                
                // Change VS to checkmark
                setTimeout(() => {
                    vsText.textContent = 'âœ“';
                    vsText.style.color = '#4caf50';
                }, 500);
                
                // Show match found
                setTimeout(() => {
                    matchFound.style.display = 'block';
                }, 1000);
                
                // Update match info and show action buttons
                setTimeout(() => {
                    document.getElementById('cropInfo').textContent = byproduct;
                    document.getElementById('demandInfo').textContent = `${quantity.toLocaleString()} kg`;
                    document.getElementById('priceInfo').textContent = `â‚¹${parseFloat(priceInput.value).toLocaleString()}/kg`;
                    document.getElementById('supplyInfo').textContent = `${supply.toLocaleString()} kg`;
                    document.getElementById('offeredPriceInfo').textContent = `â‚¹${offeredPrice.toLocaleString()}/kg`;
                    
                    actionButtons.style.display = 'flex';
                }, 1500);
                
            }, 3000); // Animation runs for 3 seconds
        }

        // Go Back to Selection Screen
        document.getElementById('goBackBtn').addEventListener('click', function() {
            battleScreen.style.display = 'none';
            selectionScreen.classList.remove('hidden');
            scrollingWrapper.style.display = 'flex'; // Reset wrapper visibility for next run
            // Reset form fields
            oilseedSelect.value = "";
            byproductSelect.innerHTML = '<option value="">-- First Select Oilseed --</option>';
            byproductSelect.disabled = true;
            quantityInput.value = "";
            priceInput.value = "";
            checkFormComplete();
        });

        // Chat button placeholder
        document.getElementById('chatBtn').addEventListener('click', function() {
            alert('Opening a chat with the matched farmer: ' + farmerName.textContent + '. You can now negotiate the final deal.');
        });
        
        // Run setup on page load
        setupOilseedOptions();

    </script>
</body>
</html>